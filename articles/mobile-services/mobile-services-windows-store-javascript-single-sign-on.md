<properties 
	pageTitle="Autenticación de la aplicación con Live Connect (JavaScript)" 
	description="Obtenga información acerca de cómo usar el inicio de sesión único de Live Connect en Servicios móviles de Azure desde una aplicación de la Tienda Windows." 
	services="mobile-services" 
	documentationCenter="windows" 
	authors="ggailey777" 
	manager="dwrede" 
	editor=""/>

<tags 
	ms.service="mobile-services" 
	ms.workload="mobile" 
	ms.tgt_pltfrm="mobile-windows-store" 
	ms.devlang="javascript" 
	ms.topic="article" 
	ms.date="04/08/2015" 
	ms.author="glenga"/>

# Autenticación de una aplicación de la Tienda Windows con la autenticación del cliente administrada mediante la cuenta de Microsoft

[AZURE.INCLUDE [mobile-services-selector-single-signon](../../includes/mobile-services-selector-single-signon.md)]

##Información general
En este tema se muestra cómo autenticar usuarios en Servicios móviles de Azure desde una aplicación de la Tienda Windows. En este tutorial podrá agregar la autenticación al proyecto de inicio rápido mediante Live Connect. Una vez que Live Connect haya realizado la autenticación correctamente, se dará la bienvenida al usuario que ha iniciado sesión por su nombre y se mostrará el valor de identificador de usuario.

>[AZURE.NOTE]Este tutorial muestra las ventajas de usar autenticación administrada por el cliente y el SDK de Live. Esto le permite autenticar más fácilmente a un usuario que ya haya iniciado sesión en el servicio móvil. También puede solicitar otros ámbitos para habilitar la aplicación para tener acceso a recursos, como OneDrive. La autenticación administrada por servicio proporciona una experiencia más generalizada y admite varios proveedores de autenticación. Para obtener más información acerca de la autenticación administrada de servicio, consulte el tema [Incorporación de la autenticación a la aplicación](mobile-services-windows-store-javascript-get-started-users.md).

Este tutorial requiere lo siguiente:

+ [SDK de Live para Windows]
+ Microsoft Visual Studio 2012 Express para Windows 8 RC o una versión posterior.
+ Primero debe completar el tutorial [Incorporación de Servicios móviles a una aplicación existente].

##Registre la aplicación para usar la cuenta Microsoft para realizar la autenticación

Para autenticar usuarios, debe registrar la aplicación en el Centro para desarrolladores de la cuenta de Microsoft. A continuación, debe conectarse este registro con el servicio móvil. Complete los pasos descritos en el tema siguiente para crear un registro de la cuenta de Microsoft y conectarla al servicio móvil.

+ [Registre sus aplicaciones para usar un inicio de sesión de la cuenta Microsoft](mobile-services-how-to-register-microsoft-authentication.md)

##<a name="permissions"></a>Restricción de los permisos para los usuarios autenticados

A continuación se debe restringir el acceso a un recurso, en este caso la tabla *TodoItems* para asegurarse de que solo sean accesibles para un usuario con sesión iniciada.

[AZURE.INCLUDE [mobile-services-restrict-permissions-windows](../../includes/mobile-services-restrict-permissions-windows.md)]

##<a name="add-authentication"></a>Incorporación de autenticación a la aplicación

Por último, agregue el SDK de Live y úselo para autenticar a los usuarios en la aplicación.

1. En el **Explorador de soluciones**, haga clic con el botón derecho en la solución y, a continuación, haga clic en **Administrar paquetes de NuGet**.

2. En el panel izquierdo, seleccione la categoría **En línea**, busque **LiveSDK**, haga clic en **Instalar** en el paquete del **SDK de Live**, seleccione todos los proyectos y, a continuación, acepte los contratos de licencia.

  	Esto agrega el SDK de Live a la solución.

3. Abra el archivo de proyecto default.html y agregue el siguiente elemento `<script>` en el elemento `<head>`.

        <script src="/js/wl.js"></script>

5. En la sobrecarga del método **app.OnActivated**, sustituya la llamada al método **refreshTodoItems** por el siguiente código:
	
        // Set the mobileClient variable to client variable generated by the tooling.
        var mobileClient = <yourClient>;

        var session = null;
        var login = function () {
            return new WinJS.Promise(function (complete) {
                WL.login({ scope: "wl.basic" }).then(function (result) {
                    session = result.session;

                    WinJS.Promise.join([
                        WL.api({ path: "me", method: "GET" }),
                        mobileClient.login(result.session.authentication_token)
                    ]).done(function (results) {
                        // Build the welcome message from the Microsoft account info.
                        var profile = results[0];                            
                        var title = "Welcome " + profile.first_name + "!";
                        var message = "You are now logged in as: "
                            + mobileClient.currentUser.userId;
                        var dialog = new Windows.UI.Popups.MessageDialog(message, title);
                        dialog.showAsync().then(function () {
                            // Reload items from the mobile service.
                            refreshTodoItems();
                        }).done(complete);
                        
                    }, function (error) {

                    });
                }, function (error) {
                    session = null;
                    var dialog = new Windows.UI.Popups.MessageDialog("You must log in.", "Login Required");
                    dialog.showAsync().done(complete);
                });
            });
        }

        var authenticate = function () {
            // Block until sign-in is successful.
            login().then(function () {
                if (session === null) {
                    // Authentication failed, try again.
                    authenticate();
                }
            });
        }

		// Initialize the Live client.
        WL.init({
            redirect_uri: mobileClient.applicationUrl
        });

		// Start the sign-in process.
        authenticate();

    De este modo se inicializa el cliente Live Connect, se envía una nueva solicitud de inicio de sesión a la cuenta de Microsoft, se envía el token de autenticación devuelto a Servicios móviles y, a continuación, se muestra la información del usuario que ha iniciado sesión.

	>[AZURE.NOTE]No debería solicitar los tokens de autenticación de Live Connection o los tokens de autorización de Servicios móviles cada vez que se ejecute la aplicación. Esto no solo es ineficaz, sino que también puede enfrentarse a problemas relacionados con el uso si varios clientes inician la aplicación al mismo tiempo. Un mejor método sería almacenar en caché los tokens y primero intentar usar el token de Servicios móviles almacenado en caché antes de llamar a **LoginWithMicrosoftAccountAsync**. Para obtener un ejemplo de cómo almacenar este token en caché, consulte [Introducción a la autenticación](mobile-services-windows-store-javascript-get-started-users.md#tokens).
	
7. Sustituya el valor `<yourClient>` de la primera línea del anterior código por la variable definida en el archivo .js agregado al conectar el proyecto al servicio móvil.
		
8. Presione la tecla F5 para ejecutar la aplicación e iniciar sesión con su cuenta Microsoft.

   	Cuando haya iniciado sesión correctamente, la aplicación debe ejecutarse sin errores y debe poder consultar a Servicios móviles y realizar actualizaciones de datos.

## <a name="next-steps"> </a>Pasos siguientes

En el siguiente tutorial, [Autorización de usuarios con scripts], usará el valor de identificador de usuario proporcionado por Servicios móviles basado en un usuario autenticado para filtrar los datos que devuelve Servicios móviles. Para obtener información sobre cómo usar otros proveedores de identidades para la autenticación, consulte [Introducción a la autenticación].

<!-- Anchors. -->
[Register your app for authentication and configure Mobile Services]: #register
[Restrict table permissions to authenticated users]: #permissions
[Add authentication to the app]: #add-authentication
[Next Steps]: #next-steps

<!-- Images. -->

<!-- URLs. -->
[Submit an app page]: http://go.microsoft.com/fwlink/p/?LinkID=266582
[My Applications]: http://go.microsoft.com/fwlink/p/?LinkId=262039
[SDK de Live para Windows]: http://go.microsoft.com/fwlink/p/?LinkId=262253
[Incorporación de Servicios móviles a una aplicación existente]: mobile-services-windows-store-javascript-get-started-data.md
[Introducción a la autenticación]: mobile-services-windows-store-javascript-get-started-users.md
[Autorización de usuarios con scripts]: ../mobile-services-windows-store-javascript-authorize-users-in-scripts.md

[Azure Management Portal]: https://manage.windowsazure.com/
 

<!---HONumber=July15_HO4-->